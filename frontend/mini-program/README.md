# 小程序端

陆合铭云健康服务平台 - 小程序端（原生微信小程序）

## 技术栈

- **平台**: 微信小程序
- **框架**: 原生小程序开发
- **设计理念**: 简单美观、用户体验优先

## 项目结构

```
mini-program/
├── app.js              # 应用入口
├── app.json            # 全局配置
├── app.wxss            # 全局样式
├── pages/              # 页面目录
│   ├── index/          # 首页
│   ├── mall/           # 商城模块
│   ├── entitlement/    # 权益模块
│   ├── booking/        # 预约模块
│   ├── order/          # 订单模块
│   ├── profile/        # 我的模块
│   ├── ai-chat/        # AI对话
│   ├── venue-detail/   # 场所详情
│   ├── aggregate/     # 聚合页
│   └── info/           # 信息页
├── utils/              # 工具函数
│   ├── api.js          # API调用封装
│   └── config.js       # 配置文件
├── images/             # 图片资源
└── project.config.json # 项目配置
```

## 开发说明

### 前置要求

1. **后端服务运行**
   - 确保后端服务已启动（默认运行在 `http://localhost:8000`）
   - 如果后端服务未运行，小程序会静默失败，不显示数据但不会报错
   - 启动后端服务：参考后端项目的 README 或运行 `docker-compose up`

2. **微信开发者工具**
   - 下载并安装微信开发者工具
   - 使用微信开发者工具打开本项目

### 配置步骤

1. **配置小程序 AppID**
   - 在 `project.config.json` 中配置你的小程序 `appid`
   - 如果没有 AppID，可以使用测试号

2. **配置后端 API 地址**
   - 修改 `utils/config.js` 中的 `API_BASE_URL`
   - 开发环境：`http://localhost:8000`
   - 生产环境：配置实际的后端域名
   - **注意**：小程序中不能直接使用 `localhost`，需要：
     - 使用真实 IP 地址（如 `http://192.168.1.100:8000`）
     - 或在微信开发者工具中开启"不校验合法域名"选项（仅开发环境）

3. **配置微信登录（可选）**
   - 开发环境：可以不配置，系统会自动使用 mock 模式
   - 生产环境：必须在后端 `.env` 文件中配置 `WECHAT_APPID` 和 `WECHAT_SECRET`
   - 参考：[微信登录配置说明](#微信登录配置)

### 常见问题

#### 1. 网络请求失败（ERR_EMPTY_RESPONSE）

**问题**：小程序请求后端 API 时出现 `ERR_EMPTY_RESPONSE` 错误

**原因**：
- 后端服务未启动
- 网络连接问题
- API 地址配置错误

**解决方案**：
1. 检查后端服务是否运行：访问 `http://localhost:8000/docs` 查看 API 文档
2. 检查 `utils/config.js` 中的 `API_BASE_URL` 是否正确
3. 如果使用 `localhost`，需要：
   - 改为本机 IP 地址（如 `http://192.168.1.100:8000`）
   - 或在微信开发者工具中开启"不校验合法域名"
4. 首页数据加载失败时会静默处理，不会显示错误提示，这是正常行为

#### 2. 微信登录配置缺失

**问题**：登录时提示"微信登录配置缺失"

**解决方案**：
- 开发环境：系统会自动使用 mock 模式，无需配置
- 生产环境：需要在后端 `.env` 文件中配置 `WECHAT_APPID` 和 `WECHAT_SECRET`

#### 3. 小程序无法访问 localhost

**问题**：小程序中无法访问 `http://localhost:8000`

**解决方案**：
- 使用本机 IP 地址替代 `localhost`（如 `http://192.168.1.100:8000`）
- 在微信开发者工具中：设置 → 项目设置 → 本地设置 → 勾选"不校验合法域名、web-view（业务域名）、TLS 版本以及 HTTPS 证书"

## 功能模块

- **首页**: Banner、快捷入口、推荐商品/场所、AI旋钮
- **商城**: 商品列表、详情、购物车、下单支付
- **权益**: 权益列表、详情、适用场所筛选
- **预约**: 场所选择、日期时段选择、预约结果、列表与取消
- **订单**: 订单列表和详情
- **我的**: 个人中心、企业绑定
- **AI对话**: 对话界面、登录校验、免责声明
- **场所详情**: 场所信息展示、服务列表与跳转
- **聚合页/信息页**: 可配置页面承载
